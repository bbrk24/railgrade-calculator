class Engine{constructor(e,t,n,r,o){this.climbRating=n,this.speed=r,this.accel=o,this.cost=1<<e+8,this.upkeep=1<<t+2}}const clamp=(e,t,n)=>Math.max(t,Math.min(e,n)),engines={workhorse:new Engine(1,1,.5,(e=>e<=2?50:e<=4?54-2*e:Math.max(5,70-6*e)),(e=>e<4?3.5-e/7:Math.max(1/3,4.9-e/2))),boiler:new Engine(0,0,.4,(e=>e<6?33-e**4/230:Math.max(3,47.7-3.5*e)),(e=>Math.max(1/3,2.59-.024*e**2))),industrial:new Engine(2,2,.95,(e=>{return t=48-3.5*e,n=3,r=30,Math.max(n,Math.min(t,r));var t,n,r}),(e=>e<7?4-e/9:Math.max(1/3,5.25-2/7*e))),spark:new Engine(3,3,.5,(e=>e<=4.5?75:e<=6?85-2*e:e>=8?112.75-5.5*e:71),(e=>e>=17?1/3:e>8?8.9-.5*e:e<7?6.2-.17*e:5)),custom:new Engine(1,1,.75,(e=>e>=2?Math.max(7,97.84-14.6*e):Math.min(75,78.83-5*e)),(e=>e>2?Math.max(1/3,5.76-e):0===e?14/3:e<=1?13/3:4)),rescue:new Engine(3,2,1,(e=>e<=8?27:e<=12?30.75-e/2:41.6-1.4*e),(e=>e<10?5.04-.106*e:e<=12?4:8-e/3))},allSame=e=>{const t=e[0];for(const n of e)if(n!==t)return!1;return!0},makeArr=e=>{const t=[];for(const[n,r]of Object.entries(e))if(r){if(r>13e5)throw new Error("Provided number(s) too large.");for(let e=0;e<r;++e)t.push(n)}return t},avg=function(e,t){return e.reduce(((n,r)=>n+t(r)/e.length),0)},sum=function(e,t){return e.reduce(((e,n)=>e+t(n)),0)},calcStats=(e,t)=>{const n=t/e.length,r=e.map((e=>engines[e])),o=avg(r,(e=>e.speed(n)));let l;0===e.length?l=0:allSame(e)&&(l=r[0].accel(n));let c=0;return l&&(c=o/l),{topSpeed:Math.round(o),hillSpeed:Math.round(o*avg(r,(e=>e.climbRating))),cost:16*t+sum(r,(e=>e.cost)),upkeep:t+sum(r,(e=>e.upkeep)),accel:l,accelTime:c}},roundThird=e=>{const t=Math.floor(e);return e-t<=1/6?`${t}`:e-t<=.5?(t||"")+"&frac13;":e-t<=5/6?(t||"")+"&frac23;":`${t+1}`},roundHalf=e=>{const t=Math.floor(e);return e-t<=1/4?`${t}`:e-t<=3/4?(t||"")+"&frac12;":`${t+1}`},elements={workhorse:document.getElementById("workhorse"),boiler:document.getElementById("boiler"),industrial:document.getElementById("industrial"),spark:document.getElementById("spark"),custom:document.getElementById("custom"),rescue:document.getElementById("rescue"),cars:document.getElementById("cars"),topSpeed:document.getElementById("top-speed"),hillSpeed:document.getElementById("hill-speed"),cost:document.getElementById("cost"),upkeep:document.getElementById("upkeep"),accelInfo:document.getElementById("accel-info"),noAccelInfo:document.getElementById("no-accel-info"),accel:document.getElementById("accel"),accelTime:document.getElementById("accel-time"),error:document.getElementById("error")},stringifyError=e=>{if(e instanceof Error)return e.toString();if("object"!=typeof e&&"function"!=typeof e||null===e)return`Error: ${e}`;return"cause"in e&&e.cause instanceof Error?e.cause.toString():`Error: ${e}`},reloadStats=()=>{elements.error.hidden=!0;try{const e={workhorse:+elements.workhorse.value,boiler:+elements.boiler.value,industrial:+elements.industrial.value,spark:+elements.spark.value,custom:+elements.custom.value,rescue:+elements.rescue.value},t=calcStats(makeArr(e),+elements.cars.value);elements.topSpeed.nodeValue=`${t.topSpeed}`,elements.hillSpeed.nodeValue=`${t.hillSpeed}`,elements.cost.nodeValue=`${t.cost}`,elements.upkeep.nodeValue=`${t.upkeep}`,void 0===t.accel?(elements.accelInfo.hidden=!0,elements.noAccelInfo.hidden=!1):(elements.accelInfo.hidden=!1,elements.noAccelInfo.hidden=!0,elements.accel.nodeValue=roundThird(t.accel),elements.accelTime.nodeValue=roundHalf(t.accelTime))}catch(e){elements.error.innerHTML="",elements.error.appendChild(document.createTextNode(stringifyError(e))),elements.error.appendChild(document.createElement("br")),elements.error.hidden=!1}};